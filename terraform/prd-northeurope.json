{
  "env": {
    "name": "production",
    "name_short": "prd",
    "tags": {
      "Environment": "production"
    },
    "vnet": {
      "ase": {
        "data_resource": true,
        "peerings": {
          "main": {}
        }
      },
      "main": {
        "address_space": [
          "__PRD_HERE__/16"
        ],
        "peerings": {
          "swedencentral": {},
          "francecentral": {},
          "ase": {
            "data_resource": true
          }
        },
        "diagnostic_enabled": true,
        "log_analytics_workspace_id": "main",
        "subnets": {
          "private-endpoint": {
            "address_prefixes": [
              "__PRD_HERE__/24"
            ]
          },
          "postgresql-flexible-server": {
            "address_prefixes": [
              "__PRD_HERE__/24"
            ],
            "delegations": {
              "main": {
                "name": "Microsoft.DBforMySQL/flexibleServers",
                "actions": [
                  "Microsoft.Network/virtualNetworks/subnets/join/action"
                ]
              }
            }
          }
        }
      },
      "swedencentral": {
        "location": "swedencentral",
        "address_space": [
          "__PRD_HERE__/16"
        ],
        "diagnostic_enabled": true,
        "log_analytics_workspace_id": "main",
        "subnets": {
          "private-endpoint": {
            "address_prefixes": [
              "__PRD_HERE__/24"
            ]
          }
        },
        "peerings": {
          "main": {}
        }
      },
      "francecentral": {
        "location": "francecentral",
        "address_space": [
          "__PRD_HERE__/16"
        ],
        "diagnostic_enabled": true,
        "log_analytics_workspace_id": "main",
        "subnets": {
          "private-endpoint": {
            "address_prefixes": [
              "__PRD_HERE__/24"
            ]
          }
        },
        "peerings": {
          "main": {}
        }
      }
    },
    "private_dns_zone": {
      "privatelink.openai.azure.com": {
        "virtual_networks": {
          "main": {},
          "ase": {
            "data_resource": true
          }
        }
      },
      "privatelink.postgres.database.azure.com": {
        "virtual_networks": {
          "main": {},
          "ase": {
            "data_resource": true
          }
        }
      }
    },
    "identity": {
      "web-app": {
        "container_registry": {
          "name": "nextens",
          "data_resource": true,
          "role": "AcrPull"
        }
      }
    },
    "log_analytics_workspace": {
      "main": {
        "sku_name": "PerGB2018",
        "retention_in_days": 30
      }
    },
    "key_vault": {
      "nextens": {
        "data_resource": true,
        "secrets": {
          "tex-postgresql-admin-username": {
            "value": "psqladmin"
          },
          "tex-postgresql-admin-password": {},
          "tex-langfuse-salt": {
            "base64": true
          },
          "tex-langfuse-encryption-key": {
            "hex": true
          },
          "tex-langfuse-nextauth-secret": {
            "base64": true
          },
          "tex-langfuse-public-key": {
            "prefix": "pk-lf-",
            "uuid": true
          },
          "tex-langfuse-secret-key": {
            "prefix": "sk-lf-",
            "uuid": true
          },
          "tex-langfuse-init-user-password": {},
          "tex-es-api-key": {
            "read_only": true
          },
          "tex-s2s-token-secret": {
            "read_only": true
          },
          "starnextensnl": {
            "read_only": true
          },
          "NextensKV": {
            "read_only": true
          }
        }
      }
    },
    "application_insights": {
      "main": {
        "log_analytics_workspace": "main",
        "application_type": "web",
        "retention_in_days": 31
      }
    },
    "databases": {
      "postgresql": {
        "main": {
          "key_vault": "main",
          "sku_name": "B_Standard_B1ms",
          "subnet": "main|postgresql-flexible-server",
          "diagnostic_enabled": true,
          "log_analytics_workspace_id": "main",
          "public_network_access_enabled": false,
          "administrator_login": "nextens|tex-postgresql-admin-username",
          "administrator_password": "nextens|tex-postgresql-admin-password",
          "private_endpoint_enabled": true,
          "private_endpoint_subnet_id": "main|private-endpoint",
          "private_dns_zones": [
            "privatelink.postgres.database.azure.com"
          ],
          "databases": {
            "langfuse": {}
          }
        }
      }
    },
    "app_service_plan": {
      "ase": {
        "name": "base3-prd-north-ai-asp",
        "os_type": "Linux",
        "sku_name": "I1v2",
        "diagnostic_enabled": true,
        "log_analytics_workspace_id": "main",
        "app_service_environment": "ase",
        "certificates": {
          "NextensKV": "nextens|NextensKV",
          "starnextensnl": "nextens|starnextensnl"
        },
        "autoscale": {
          "cpu": {
            "profiles": [
              {
                "name": "default",
                "capacity": {
                  "default": 1,
                  "minimum": 1,
                  "maximum": 3
                },
                "rules": [
                  {
                    "name": "cpu scale out",
                    "metric_trigger": {
                      "metric_name": "CpuPercentage",
                      "metric_namespace": "microsoft.web/serverfarms",
                      "operator": "GreaterThan",
                      "threshold": 65,
                      "statistic": "Average",
                      "time_aggregation": "Average",
                      "time_grain": "PT1M",
                      "time_window": "PT10M"
                    },
                    "scale_action": {
                      "direction": "Increase",
                      "type": "ChangeCount",
                      "value": "1",
                      "cooldown": "PT5M"
                    }
                  },
                  {
                    "name": "cpu scale in",
                    "metric_trigger": {
                      "metric_name": "CpuPercentage",
                      "metric_namespace": "microsoft.web/serverfarms",
                      "operator": "LessThan",
                      "threshold": 45,
                      "statistic": "Average",
                      "time_aggregation": "Average",
                      "time_grain": "PT1M",
                      "time_window": "PT10M"
                    },
                    "scale_action": {
                      "direction": "Decrease",
                      "type": "ChangeCount",
                      "value": "1",
                      "cooldown": "PT5M"
                    }
                  },
                  {
                    "name": "memory scale out",
                    "metric_trigger": {
                      "metric_name": "MemoryPercentage",
                      "metric_namespace": "microsoft.web/serverfarms",
                      "operator": "GreaterThan",
                      "threshold": 80,
                      "statistic": "Average",
                      "time_aggregation": "Average",
                      "time_grain": "PT1M",
                      "time_window": "PT10M"
                    },
                    "scale_action": {
                      "direction": "Increase",
                      "type": "ChangeCount",
                      "value": "1",
                      "cooldown": "PT5M"
                    }
                  },
                  {
                    "name": "memory scale in",
                    "metric_trigger": {
                      "metric_name": "MemoryPercentage",
                      "metric_namespace": "microsoft.web/serverfarms",
                      "operator": "LessThan",
                      "threshold": 60,
                      "statistic": "Average",
                      "time_aggregation": "Average",
                      "time_grain": "PT1M",
                      "time_window": "PT10M"
                    },
                    "scale_action": {
                      "direction": "Decrease",
                      "type": "ChangeCount",
                      "value": "1",
                      "cooldown": "PT5M"
                    }
                  }
                ]
              },
              {
                "name": "reset to the default scale capacity at midnight",
                "capacity": {
                  "default": 1,
                  "minimum": 1,
                  "maximum": 3
                },
                "recurrence": {
                  "timezone": "W. Europe Standard Time",
                  "days": [
                    "Monday",
                    "Tuesday",
                    "Wednesday",
                    "Thursday",
                    "Friday",
                    "Saturday",
                    "Sunday"
                  ],
                  "hours": [
                    23
                  ],
                  "minutes": [
                    59
                  ]
                }
              }
            ]
          }
        }
      }
    },
    "web_app": {
      "frontend": {
        "app_service_plan": "ase",
        "diagnostic_enabled": true,
        "log_analytics_workspace_id": "main",
        "application_insights": "main",
        "site_config": {
          "application_stack": {
            "dotnet_version": "9.0"
          }
        },
        "slots": {
          "staging": {}
        }
      },
      "bff": {
        "app_service_plan": "ase",
        "diagnostic_enabled": true,
        "log_analytics_workspace_id": "main",
        "application_insights": "main",
        "site_config": {
          "application_stack": {
            "dotnet_version": "9.0"
          }
        },
        "slots": {
          "staging": {}
        }
      },
      "assistant": {
        "app_service_plan": "ase",
        "diagnostic_enabled": true,
        "log_analytics_workspace_id": "main",
        "application_insights": "main",
        "container_registry": "nextens",
        "search_service": "fiscaaltotaal",
        "identities": {
          "web-app": {}
        },
        "site_config": {
          "application_stack": {
            "docker_image_name": "nextens-tex-ai-api:latest"
          }
        },
        "application_settings": {
          "AZURE_AI_SEARCH_INDEX": "idx-content-20241106",
          "ES_INDEX_NAME": "naslag-almanakken-2,naslag-wetten-2,naslag-fiscale-cijfers-2,naslag-onderwerpen-2",
          "ES_URL": "https://naslag-search-prd-secondary.es.westeurope.azure.elastic-cloud.com",
          "ES_API_KEY": "nextens|tex-es-api-key",
          "VECTOR_FIELD": "embeddings",
          "LANGFUSE_PUBLIC_KEY": "nextens|tex-langfuse-public-key",
          "LANGFUSE_SECRET_KEY": "nextens|tex-langfuse-secret-key",
          "S2S_TOKEN_SECRET": "nextens|tex-s2s-token-secret",
          "OPENAI_API_VERSION": "2024-10-01",
          "OPEN_AI_EMBEDDING_DIMENSIONS": 1536,
          "OPEN_AI_FRANCE_API_VERSION": "gpt-35-turbo-16k",
          "OPEN_AI_FRANCE_EMBEDDING_MODEL": "ada-embedding",
          "OPEN_AI_SWEDEN_API_VERSION": "2023-07-01-preview",
          "OPEN_AI_SWEDEN_EMBEDDING_MODEL": "text-embedding-ada-002",
          "OPEN_AI_SWEDEN_4_DEPLOYMENT_NAME": "eval-4",
          "OPEN_AI_SWEDEN_4O_DEPLOYMENT_NAME": "eval-4o",
          "OPEN_AI_SWEDEN_4OMINI_DEPLOYMENT_NAME": "gpt-4o-mini"
        },
        "slots": {
          "staging": {}
        }
      },
      "langfuse": {
        "app_service_plan": "ase",
        "diagnostic_enabled": true,
        "log_analytics_workspace_id": "main",
        "application_insights": "main",
        "container_registry": "nextens",
        "database": "main",
        "identities": {
          "web-app": {}
        },
        "site_config": {
          "application_stack": {
            "docker_image_name": "langfuse:2"
          }
        },
        "application_settings": {
          "DATABASE_NAME": "langfuse",
          "WEBSITES_PORT": "3000",
          "LANGFUSE_INIT_ORG_ID": "nextens",
          "LANGFUSE_INIT_ORG_NAME": "Nextens",
          "LANGFUSE_INIT_PROJECT_ID": "nextens-tex",
          "LANGFUSE_INIT_PROJECT_NAME": "Nextens Tex",
          "LANGFUSE_INIT_PROJECT_PUBLIC_KEY": "nextens|tex-langfuse-public-key",
          "LANGFUSE_INIT_PROJECT_SECRET_KEY": "nextens|tex-langfuse-secret-key",
          "LANGFUSE_INIT_USER_EMAIL": "nextens-tex@nextens.nl",
          "LANGFUSE_INIT_USER_NAME": "Nextens TEX",
          "LANGFUSE_INIT_USER_PASSWORD": "nextens|tex-langfuse-init-user-password",
          "ENCRYPTION_KEY": "nextens|tex-langfuse-encryption-key",
          "NEXTAUTH_SECRET": "nextens|tex-langfuse-nextauth-secret",
          "SALT": "nextens|tex-langfuse-salt"
        }
      }
    },
    "cognitive_service": {
      "sweden": {
        "location": "swedencentral",
        "kind": "OpenAI",
        "sku_name": "S0",
        "diagnostic_enabled": true,
        "log_analytics_workspace_id": "main",
        "public_network_access_enabled": false,
        "private_endpoint_enabled": true,
        "private_endpoint_subnet_id": "swedencentral|private-endpoint",
        "private_dns_zones": [
          "privatelink.openai.azure.com"
        ],
        "deployments": {
          "eval-4": {
            "model": {
              "name": "gpt-4",
              "version": "0613"
            },
            "sku": {
              "name": "Standard",
              "capacity": 10
            }
          },
          "eval-4o": {
            "model": {
              "name": "gpt-4o",
              "version": "2024-05-13"
            },
            "sku": {
              "name": "Standard",
              "capacity": 120
            }
          },
          "text-embedding-ada-002": {
            "model": {
              "name": "text-embedding-ada-002",
              "version": "2"
            },
            "sku": {
              "name": "Standard",
              "capacity": 120
            }
          },
          "gpt-4o-mini": {
            "model": {
              "name": "gpt-4o-mini",
              "version": "2024-07-18"
            },
            "sku": {
              "name": "GlobalStandard",
              "capacity": 50000
            }
          }
        }
      },
      "france": {
        "location": "francecentral",
        "kind": "OpenAI",
        "sku_name": "S0",
        "diagnostic_enabled": true,
        "log_analytics_workspace_id": "main",
        "public_network_access_enabled": false,
        "private_endpoint_enabled": true,
        "private_endpoint_subnet_id": "francecentral|private-endpoint",
        "private_dns_zones": [
          "privatelink.openai.azure.com"
        ],
        "deployments": {
          "ada-embedding": {
            "model": {
              "name": "text-embedding-ada-002",
              "version": "2"
            },
            "sku": {
              "name": "Standard",
              "capacity": 120
            }
          },
          "eval": {
            "model": {
              "name": "gpt-4",
              "version": "0613"
            },
            "sku": {
              "name": "Standard",
              "capacity": 10
            }
          }
        }
      }
    }
  }
}