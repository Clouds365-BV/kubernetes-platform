digraph G {
    rankdir=TB;
    compound=true;
    node [shape=box, style="rounded,filled", fillcolor=lightblue, fontname="Arial", margin=0.2];
    edge [fontname="Arial", fontsize=10];

    subgraph cluster_azure {
        label="Azure Cloud";
        style=filled;
        color=lightgrey;

        subgraph cluster_region1 {
            label="Primary Region (North Europe)";
            style=filled;
            color=lightyellow;

            subgraph cluster_vnet1 {
                label="Virtual Network";
                style=filled;
                color=lightcyan;

                subgraph cluster_aks_primary {
                    label="AKS Cluster Primary";
                    style=filled;
                    color=lightgreen;

                    systempool_p [label="System Node Pool"];
                    userpool1_p [label="User Node Pool 1"];
                    userpool2_p [label="User Node Pool 2"];

                    subgraph cluster_k8s_components_p {
                        label="K8s Components";
                        style=filled;
                        color=white;

                        apiserver_p [label="API Server"];
                        etcd_p [label="etcd"];
                        controller_p [label="Controller Manager"];
                        scheduler_p [label="Scheduler"];
                    }

                    subgraph cluster_namespaces_p {
                        label="Namespaces";
                        style=filled;
                        color=white;

                        team1_p [label="team-1 Namespace"];
                        team2_p [label="team-2 Namespace"];
                        blog_p [label="blog Namespace"];
                        system_p [label="kube-system"];
                    }

                    subgraph cluster_networking_p {
                        label="Advanced Networking";
                        style=filled;
                        color=white;

                        cilium_p [label="Cilium CNI"];
                        istio_p [label="Istio Service Mesh"];
                        netpol_p [label="Network Policies"];
                    }
                }

                agw [label="Application Gateway", fillcolor=lightsalmon];
                firewall [label="Azure Firewall", fillcolor=lightsalmon];
            }

            keyvault [label="Azure Key Vault", fillcolor=lightpink];
            acr [label="Azure Container Registry", fillcolor=lightpink];
            monitor [label="Azure Monitor", fillcolor=lightpink];
            mysql [label="Azure MySQL", fillcolor=lightpink];
        }

        subgraph cluster_region2 {
            label="Secondary Region (West Europe)";
            style=filled;
            color=lightyellow;

            subgraph cluster_vnet2 {
                label="Virtual Network";
                style=filled;
                color=lightcyan;

                subgraph cluster_aks_secondary {
                    label="AKS Cluster Secondary";
                    style=filled;
                    color=lightgreen;

                    systempool_s [label="System Node Pool"];
                    userpool1_s [label="User Node Pool 1"];

                    subgraph cluster_k8s_components_s {
                        label="K8s Components";
                        style=filled;
                        color=white;

                        apiserver_s [label="API Server"];
                        etcd_s [label="etcd"];
                    }

                    subgraph cluster_namespaces_s {
                        label="Namespaces";
                        style=filled;
                        color=white;

                        blog_s [label="blog Namespace"];
                        system_s [label="kube-system"];
                    }

                    subgraph cluster_networking_s {
                        label="Advanced Networking";
                        style=filled;
                        color=white;

                        cilium_s [label="Cilium CNI"];
                        istio_s [label="Istio Service Mesh"];
                    }
                }

                agw_s [label="Application Gateway", fillcolor=lightsalmon];
                firewall_s [label="Azure Firewall", fillcolor=lightsalmon];
            }

            keyvault_s [label="Azure Key Vault", fillcolor=lightpink];
            mysql_s [label="Azure MySQL", fillcolor=lightpink];
        }

        frontdoor [label="Azure Front Door", fillcolor=gold];
        azuread [label="Azure AD", fillcolor=lightpink];
    }

    internet [label="Internet", shape=cloud, fillcolor=white];
    devops [label="DevOps Teams", shape=box, fillcolor=white];
    secteam [label="Security Team", shape=box, fillcolor=white];

    // Connections
    internet -> frontdoor;
    frontdoor -> agw [lhead=cluster_vnet1];
    frontdoor -> agw_s [lhead=cluster_vnet2];

    agw -> cilium_p;
    agw_s -> cilium_s;

    cilium_p -> team1_p;
    cilium_p -> team2_p;
    cilium_p -> blog_p;

    cilium_s -> blog_s;

    blog_p -> mysql;
    blog_s -> mysql_s;

    mysql -> mysql_s [label="Replication"];

    blog_p -> keyvault;
    team1_p -> keyvault;
    team2_p -> keyvault;

    blog_s -> keyvault_s;

    devops -> azuread;
    secteam -> azuread;
    azuread -> apiserver_p [label="RBAC"];
    azuread -> apiserver_s [label="RBAC"];

    istio_p -> istio_s [label="Federation"];

    blog_p -> blog_s [label="Service Mesh"];
}

